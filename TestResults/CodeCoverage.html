<!DOCTYPE html>
<html lang="en">
<head>
<title>Coverage</title>
<meta charset="utf-8"/>
<style>
@media screen{
    html {background-color: #FFFFF0;}
body {
    font-size: 16px;
    font-family : Verdana, "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
    margin: 1em;
}
th, td {padding: 5px 10px;}
th {text-align: left;}
h1, h2, h3, h4, h5, h6 {color: #424242;}
h1 {font-size: 22px;}
h2 {font-size: 18px; margin-top: 2em; margin-bottom:0.3em;}
tbody tr:nth-child(even) {background-color: #F0F0F0;}
tbody tr:nth-child(odd) {background-color: #FAFAFA;}
th {background-color: #E6E6E6;color: #424242;}
table {border: silver 1px solid; font-size: 14px;font-family: APLFont, monospace;}
code , code a {font-size: 14px; font-family: APLFont, monospace;}
code.header {
    font-size: 16px; 
    font-family: APLFont, monospace; 
    margin: 1.5em 0.5em 0 0.5em; 
    padding:0;
    display: block;
}
div.code-block {
    border: 1px silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 0.5em 0.5em 0.5em 0.5em;
    padding: 0.5em;
}
div.code-block.missing {
    background-color: #fa605254;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
ul li, ol li {margin: 0.7em 0.2em;}
.float-right {float:right;}
.no-underline {    text-decoration :none;}
.top-links {font-size:20px; padding-left: 0.6em;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5px; padding-top:0; font-size: 9px;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 0.5em; padding: 0.5em;}
}
@media print{@page {size: portrait}
@page {
    margin: 1cm 1cm 1cm 1.75cm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
  }
}
body {
    font: 12pt "Times New Roman", Times, serif;
    line-height: 1.2;
     /* CSS3 filter, at the moment Webkit only. Prefix it for future implementations */
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%); /* future-proof */
}
h1 {font-size: 18pt;}
h2 {font-size: 16pt; margin-top: 10pt; margin-bottom: 3pt;}
th, td {padding: 2pt 3pt;}
th {text-align: left;background-color: #DBDBDB;}
tbody tr:nth-child(odd) {background-color: #EDEDED;}
table {
    color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    font-size: 8pt;
    font-family: APLFont, monospace;
}
div.keep-together {break-inside: avoid; break-before:auto;}
table {border: silver 1pt solid;}
code , code a {font-size: 8pt; font-family: APLFont, monospace;}
code.header {
    font-size: 8pt;
    font-family: APLFont, monospace;
    margin: 7pt 3pt 0 10pt;
    padding:0;
    display: block;
}
div.code-block {
    border: 1pt silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 4pt 4pt 4pt 4pt;
    padding: 4pt;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
a {text-decoration: none;color: black;}
ul li, ol li {margin: 8pt 3pt;}
.no-print {display:none;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5pt; padding-top:0; font-size: 6pt;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 8px; padding: 8px;}
}
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.js"></script>
</head>
<body>
<h1 id="top">Coverage Report</h1>
<p>Watched: 25 fns/opr within <code>#.CommTools.CommTools</code></p>
<p>The test suite was executed once:</p>
<table>
<thead>
<tr><th>Executed at</th><th>APLVersion</th><th>Memory (MB)</th></tr>
</thead>
<tbody>
<tr><td>2024-12-22 16:55:00</td><td>Windows-64 ⋄ 20.0.50525.0 ⋄ W ⋄ Development ⋄ Unicode</td><td>113</td></tr>
</tbody>
</table>
<p>Overall 84% of the testable code is covered.</p>
<p>(Comment lines, empty lines, all <code>:End</code>* lines etc. are ignored)</p>
<p>10 of the fns/opr are 100% covered.</p>
<div id="partly-covered" class="keep-together">
<table id="percent">
<thead>
<tr><th style="text-align:left;">Function/Operator</th><th style="text-align:left;">Lines not executed</th><th style="text-align:left;">Coverage</th><th style="text-align:right;">≢</th></tr>
</thead>
<tbody>
<tr class="uncovered"><td><a href="#listing_1" title="Link to listing">#.CommTools.CommTools.Copyright</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_2" title="Link to listing">#.CommTools.CommTools.TatinVars.ASSETS</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_3" title="Link to listing">#.CommTools.CommTools.TatinVars.DEPENDENCIES</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_4" title="Link to listing">#.CommTools.CommTools.TatinVars.GetFullPath2AssetsFolder</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_5" title="Link to listing">#.CommTools.CommTools.TatinVars.HOME</a></td><td>9←≢2-10</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_6" title="Link to listing">#.CommTools.CommTools.TatinVars.ID</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_7" title="Link to listing">#.CommTools.CommTools.TatinVars.URI</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr><td><a href="#listing_8" title="Link to listing">#.CommTools.CommTools.TatinVars.CONFIG</a></td><td>21←≢2-22</td><td>5</td><td>22</td></tr>
<tr><td><a href="#listing_9" title="Link to listing">#.CommTools.CommTools.AddAutomation</a></td><td>5←≢26-30</td><td>75</td><td>20</td></tr>
<tr><td><a href="#listing_10" title="Link to listing">#.CommTools.CommTools.Version</a></td><td>6</td><td>80</td><td>5</td></tr>
<tr><td><a href="#listing_11" title="Link to listing">#.CommTools.CommTools.AskForNumber</a></td><td>5←≢52-54,58,63</td><td>89</td><td>45</td></tr>
<tr><td><a href="#listing_12" title="Link to listing">#.CommTools.CommTools.Pause</a></td><td>38, 39, 40</td><td>89</td><td>28</td></tr>
<tr><td><a href="#listing_13" title="Link to listing">#.CommTools.CommTools.Select</a></td><td>4←≢54-55,57-58</td><td>95</td><td>80</td></tr>
<tr><td><a href="#listing_14" title="Link to listing">#.CommTools.CommTools.AskForText</a></td><td>51, 73</td><td>96</td><td>50</td></tr>
<tr><td><a href="#listing_15" title="Link to listing">#.CommTools.CommTools.YesOrNo</a></td><td>23, 63, 66</td><td>96</td><td>68</td></tr>
<tr class="fullyCovered"><td><a href="#listing_16" title="Link to listing">#.CommTools.CommTools.Assert</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_17" title="Link to listing">#.CommTools.CommTools.Cleanup</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_18" title="Link to listing">#.CommTools.CommTools.ErrNo</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_19" title="Link to listing">#.CommTools.CommTools.FindAutomationIndex</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_20" title="Link to listing">#.CommTools.CommTools.Help</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_21" title="Link to listing">#.CommTools.CommTools.LF</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_22" title="Link to listing">#.CommTools.CommTools.ListAutomation</a></td><td></td><td>100</td><td>15</td></tr>
<tr class="fullyCovered"><td><a href="#listing_23" title="Link to listing">#.CommTools.CommTools.Log</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_24" title="Link to listing">#.CommTools.CommTools.Public</a></td><td></td><td>100</td><td>11</td></tr>
<tr class="fullyCovered"><td><a href="#listing_25" title="Link to listing">#.CommTools.CommTools.ReplaceCRbyLF</a></td><td></td><td>100</td><td>0</td></tr>
</tbody>
</table>
</div>
<script>
$(document).ready(function() {
    var oTable;
    oTable = $("#percent").DataTable( {
        paging:   false,
        ordering: true,
        info:     true,
        fixedHeader: true,
        order: [2,"asc"],
        dom: "Bft",
        drawCallback: function( settings ) {
             var api = this.api();
             $('.header[id^="listing_"]').next().addBack().css("display","none");
             api.rows( {page:"current"} ).data().each(function(data){
              id = data[0];
              id = id.match(/"(\#.*?)"/);
              if (id){$(id[1]).next().addBack().css("display","block");}
             })
        },      
        buttons: [
        {
            text: "Partly covered (8)",
            titleAttr: "50%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^(?!(0%|100%)).*";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Uncovered (7)",
            titleAttr: "0%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^0%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Fully covered (10)",
            titleAttr: "100%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "100%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "All (25)",
            titleAttr: "all",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = ".";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
    ],
 
        columnDefs: [
            {className: "align-right", targets: [2,3]
            },
            {
                render: function ( data, type, row, meta ) {
                            return data+"%" ;        
                        },
                targets: 2
            }
        ]             
    } );
    oTable.button(0).trigger();

} );    
</script>
<h2>Listings</h2>
<code class="header" id="listing_1">#.CommTools.CommTools.Copyright &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Copyright</code>
<code class="emphasize">→[1]  r←'Copyright by Kai Jaeger ⋄ https://kai-jaeger.de ⋄ kai@aplteam.com'</code>
</div>
<code class="header" id="listing_2">#.CommTools.CommTools.TatinVars.ASSETS &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ASSETS</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_3">#.CommTools.CommTools.TatinVars.DEPENDENCIES &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←DEPENDENCIES</code>
<code class="emphasize">→[1]  r←⍬</code>
</div>
<code class="header" id="listing_4">#.CommTools.CommTools.TatinVars.GetFullPath2AssetsFolder &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetFullPath2AssetsFolder</code>
<code class="emphasize">→[1]  :If 0&lt;≢r←ASSETS</code>
<code class="emphasize">→[2]  :AndIf 0&lt;≢HOME</code>
<code class="emphasize">→[3]  :AndIf ⎕NEXISTS HOME</code>
<code class="emphasize">→[4]      r←HOME,'/',ASSETS</code>
<code> [5]  :EndIf</code>
</div>
<code class="header" id="listing_5">#.CommTools.CommTools.TatinVars.HOME &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←HOME</code>
<code> [1]  ⍝ Returns folder package was loaded from or current directory or an empty vector if both are not valid</code>
<code class="emphasize">→[2]   ⎕IO←1 ⋄ ⎕ML←1</code>
<code class="emphasize">→[3]   r←'C:/T/Projects/APLTree/CommTools'   ⍝ Original source</code>
<code class="emphasize">→[4]   :If ~⎕NEXISTS r</code>
<code class="emphasize">→[5]       (dir name extension)←⎕NPARTS r</code>
<code class="emphasize">→[6]       r←(⊃1 ⎕NPARTS''),(2⊃⎕NPARTS ¯1↓dir),'/',name,extension ⍝ Try current dir</code>
<code class="emphasize">→[7]   :AndIf ~⎕NEXISTS r</code>
<code class="emphasize">→[8]       r←(⊃1 ⎕NPARTS''),name,extension</code>
<code class="emphasize">→[9]   :AndIf ~⎕NEXISTS r</code>
<code class="emphasize">→[10]      r←''</code>
<code> [11]  :EndIf</code>
</div>
<code class="header" id="listing_6">#.CommTools.CommTools.TatinVars.ID &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ID</code>
<code class="emphasize">→[1]  r←'aplteam-CommTools-2.0.0+88'</code>
</div>
<code class="header" id="listing_7">#.CommTools.CommTools.TatinVars.URI &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←URI</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_8">#.CommTools.CommTools.TatinVars.CONFIG &mdash; 5%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←CONFIG</code>
<code> [1]   r←'{</code>
<code class="emphasize">→[2]    api: "",</code>
<code class="emphasize">→[3]    assets: "",</code>
<code class="emphasize">→[4]    description: "Communication tools for interactions in the session: YesOrNo and Select",</code>
<code class="emphasize">→[5]    documentation: "",</code>
<code class="emphasize">→[6]    files: "",</code>
<code class="emphasize">→[7]    group: "aplteam",</code>
<code class="emphasize">→[8]    io: 1,</code>
<code class="emphasize">→[9]    license: "MIT",</code>
<code class="emphasize">→[10]   lx: "",</code>
<code class="emphasize">→[11]   maintainer: "kai@aplteam.com",</code>
<code class="emphasize">→[12]   minimumAplVersion: "18.0",</code>
<code class="emphasize">→[13]   ml: 1,</code>
<code class="emphasize">→[14]   name: "CommTools",</code>
<code class="emphasize">→[15]   os_lin: 1,</code>
<code class="emphasize">→[16]   os_mac: 1,</code>
<code class="emphasize">→[17]   os_win: 1,</code>
<code class="emphasize">→[18]   project_url: "https://github.com/aplteam/CommTools",</code>
<code class="emphasize">→[19]   source: "APLSource/CommTools",</code>
<code class="emphasize">→[20]   tags: "communication-tools,yes-or-no,select-tool",</code>
<code class="emphasize">→[21]   userCommandScript: "",</code>
<code class="emphasize">→[22]   version: "2.0.0+88",</code>
<code> [23] }'</code>
</div>
<code class="header" id="listing_9">#.CommTools.CommTools.AddAutomation &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{overwrite}AddAutomation(type id value)</code>
<code> [1]  ⍝ Use this to add a line to `∆Automation` or, if it does not yet exist, create `∆Automation`.</code>
<code> [2]  ⍝ If `id` is already defined for `type`, the user is questioned whether she really wants to overwrite</code>
<code> [3]  ⍝ the already existing definition. If she answers "No" no action is taken.\\</code>
<code> [4]  ⍝ You can enforce an update by passing a 1 as ⍺ (overwrite).</code>
<code> [5]  ⍝ `type` must be one of `YesOrNo`, `Select`, `Pause`, AskForText` or `AskForNumber.</code>
<code> [6]  ⍝ If it's not, an error is thrown.\\</code>
<code> [7]  ⍝ Returns 0 for "no action", 1 for "updated" and 2 for "added".</code>
<code> [8]   overwrite←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'overwrite'</code>
<code> [9]   r←0</code>
<code> [10]  :If 0=⎕NC'∆Automation'</code>
<code> [11]      ∆Automation←0 4⍴'' '' '' 0</code>
<code> [12]  :EndIf</code>
<code> [13]  'Optional left argument, when specified, must be a scalar Boolean'Assert(⊂overwrite)∊0 1</code>
<code> [14]  'Invalid type'Assert(⊂type)∊'YesOrNo' 'Select' 'Pause' 'AskForText' 'AskForNumber'</code>
<code> [15]  'ID must not be empty'Assert 0&lt;≢id</code>
<code> [16]  :Select type</code>
<code> [17]  :Case 'AskForNumber'</code>
<code> [18]      'Return value: invalid data type'Assert(,0)≡1↑0⍴⊂value</code>
<code> [19]  :Case 'YesOrNo'</code>
<code> [20]      'Invald return value; must be one of: "YyNn"'Assert(0=≢value)∨(⊂value)∊'YyNn'</code>
<code> [21]  :EndSelect</code>
<code> [22]  :If ⍬≡ind←FindAutomationIndex type id</code>
<code> [23]      ∆Automation⍪←type id value 0</code>
<code> [24]      r←2</code>
<code> [25]  :Else</code>
<code class="emphasize">→[26]      :If overwrite</code>
<code class="emphasize">→[27]          msg←'@ &lt;',id,'&gt; is already defined for &lt;',type,'&gt;'</code>
<code class="emphasize">→[28]      :OrIf msg Assert YesOrNo msg,' - overwrite? (will reset the counter) '</code>
<code class="emphasize">→[29]          ∆Automation[ind;]←type id value 0</code>
<code class="emphasize">→[30]          r←1</code>
<code> [31]      :EndIf</code>
<code> [32]  :EndIf</code>
<code> [33] ⍝Done</code>
</div>
<code class="header" id="listing_10">#.CommTools.CommTools.Version &mdash; 80%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Version</code>
<code> [1] ⍝ See also `History`</code>
<code> [2]  r←''</code>
<code> [3]  :If 0&lt;⎕NC'TatinVars.CONFIG'</code>
<code> [4]      r←(⎕JSON⍠('Dialect' 'JSON5')⊢TatinVars.CONFIG).version</code>
<code> [5]  :ElseIf 0&lt;##.⎕NC'TatinVars.CONFIG'</code>
<code class="emphasize">→[6]      r←(⎕JSON⍠('Dialect' 'JSON5')⊢##.TatinVars.CONFIG).version</code>
<code> [7]  :EndIf</code>
<code> [8]  ⍝Done</code>
</div>
<code class="header" id="listing_11">#.CommTools.CommTools.AskForNumber &mdash; 89%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  value←{enforce}(CheckFn AskForNumber)question</code>
<code> [1]  ⍝ Operator asking a question and allowing the user to enter a number.\\</code>
<code> [2]  ⍝ By entering "`∘∘∘`" the user may interrupt `AskForNumber`: this activates a stop.\\</code>
<code> [3]  ⍝ `CheckFn` is supposed to be a function that gets the input as `⍵` and must return a Boolean</code>
<code> [4]  ⍝ with a 1 indicating that the input is okay and 0 that it is not. If you don't need/want</code>
<code> [5]  ⍝ a check function pass `{1}` as left operand.\\</code>
<code> [6]  ⍝ If the user refuses to enter a number an empty vector is returned.</code>
<code> [7]  ⍝ However, you might prevent this from happening by specifying a 1 as `⍺` (`enforce`), meaning that</code>
<code> [8]  ⍝ the user must enter a number in order to continue.\\</code>
<code> [9]   enforce←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'enforce'</code>
<code> [10]  'Left argument ("enforce numeric input")must be a Boolean'Assert enforce∊0 1</code>
<code> [11]  value←⍬</code>
<code> [12]  success←flag←0</code>
<code> [13]  :If ~(≡question)∊0 1</code>
<code> [14]      question←1↓⊃,/LF,¨question</code>
<code> [15]  :EndIf</code>
<code> [16]  question←ReplaceCRbyLF question</code>
<code> [17]  question←{⍵↓⍨+/∧\' '=⍵}question</code>
<code> [18]  :Repeat</code>
<code> [19]      firstPart←{⍵↑⍨¯1+⌊/⍵⍳LF,' '}question</code>
<code> [20]      :If 0&lt;⎕NC'∆Automation'</code>
<code> [21]          AskForNumber_Answers←(∆Automation[;1]≡¨⊂'AskForNumber')⌿∆Automation[;2 3]</code>
<code> [22]          AskForNumber_Answers←(0&lt;≢¨' '~⍨¨AskForNumber_Answers[;1])⌿AskForNumber_Answers</code>
<code> [23]          AskForNumber_Answers[;1]←{⍵↓⍨+/∧\' '=⍵}¨AskForNumber_Answers[;1]</code>
<code> [24]      :AndIf 0&lt;≢AskForNumber_Answers</code>
<code> [25]          :If AliasChar∊firstPart</code>
<code> [26]              ind←firstPart⍳AliasChar</code>
<code> [27]          :AndIf ∧/~(LF,' ')∊ind↑question</code>
<code> [28]              (alias question)←ind{(⍺↑⍵)(⍺↓⍵)}question</code>
<code> [29]              flag←0&lt;+/bool←({⍵↑⍨⍵⍳AliasChar}¨AskForNumber_Answers[;1])≡¨⊂alias</code>
<code> [30]          :Else</code>
<code> [31]              flag←0&lt;+/bool←AskForNumber_Answers[;1]≡¨⊂question</code>
<code> [32]          :EndIf</code>
<code> [33]          :If flag</code>
<code> [34]              'Multiple pre-prepared answers qualify?!'Assert 1=+/bool</code>
<code> [35]              input←⍕2⊃AskForNumber_Answers[bool⍳1;]</code>
<code> [36]              'AskForNumber'Log⊃AskForNumber_Answers[bool⍳1;]</code>
<code> [37]          :EndIf</code>
<code> [38]      :Else</code>
<code> [39]          :If (⌊/firstPart⍳' ',LF)&gt;firstPart⍳AliasChar</code>
<code> [40]              question←{~AliasChar∊⍵:⍵ ⋄ ⍵↓⍨⍵⍳AliasChar}question</code>
<code> [41]          :EndIf</code>
<code> [42]      :EndIf</code>
<code> [43]      :If ~flag</code>
<code> [44]          input←⍞,0/⍞←question,((':'≠¯1↑question)/':'),' '</code>
<code> [45]          :If '∘∘∘'≡¯3↑input</code>
<code> [46]              (1+⊃⎕LC)⎕STOP⊃⎕SI</code>
<code> [47]              ∘∘∘ ⍝ Deliberate stop caused by user input</code>
<code> [48]          :EndIf</code>
<code> [49]          input←{⍵↑⍨1+-(⌽⍵)⍳':'}input</code>
<code> [50]      :EndIf</code>
<code> [51]      :If 0=≢input~' '</code>
<code class="emphasize">→[52]      :AndIf ~enforce</code>
<code class="emphasize">→[53]          value←⍬</code>
<code class="emphasize">→[54]          :Return</code>
<code> [55]      :Else</code>
<code> [56]          (valid value)←⎕VFI input</code>
<code> [57]          :If 1≠≢valid</code>
<code class="emphasize">→[58]              ⎕←'Please enter precisely one number'</code>
<code> [59]          :ElseIf valid</code>
<code> [60]              success←CheckFn value</code>
<code> [61]              value←⊃value</code>
<code> [62]          :Else</code>
<code class="emphasize">→[63]              ⎕←'You did not enter a valid number, please retry!'</code>
<code> [64]          :EndIf</code>
<code> [65]      :EndIf</code>
<code> [66]  :Until success</code>
<code> [67] ⍝Done</code>
</div>
<code class="header" id="listing_12">#.CommTools.CommTools.Pause &mdash; 89%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {flag}←{lineFlag}Pause msg</code>
<code> [1]   ⍝ Prints `msg` to the session and tells the user that she must press &lt;enter&gt; if she wants to continue.</code>
<code> [2]   ⍝ By entering "`∘∘∘`" the user may interrupt `Pause`: this activates a stop.\\</code>
<code> [3]   ⍝ The optional left argument `lineFlag` defaults to 0. If it's 1 then a line is printed. The length</code>
<code> [4]   ⍝ is defined by `⎕PW-1`.\\</code>
<code> [5]   ⍝ You can prevent `Pause` from displaying the message and requiring the user to press &lt;enter&gt;,</code>
<code> [6]   ⍝ refer to the documentation with ]ADoc CommTools, catchword "Automation"\\</code>
<code> [7]   ⍝ The function will return 1 in case it did present the message and stopped, and 0 otherwise (when</code>
<code> [8]   ⍝ automation prevented that).</code>
<code> [9]   lineFlag←{0=⎕NC ⍵:0 ⋄ ⍎⍵}'lineFlag'</code>
<code> [10]  msg←⊃LF{⍺,⍺⍺,⍵}/⊆msg</code>
<code> [11]  msg←ReplaceCRbyLF msg</code>
<code> [12]  flag←1</code>
<code> [13]  :If 0&lt;⎕NC'∆Automation'</code>
<code> [14]  :AndIf 0&lt;≢∆Automation</code>
<code> [15]      NoPause←(∆Automation[;1]≡¨⊂'Pause')⌿∆Automation[;2 3]</code>
<code> [16]      :If (,'*')≡,NoPause[;1]</code>
<code> [17]          flag←0</code>
<code> [18]          'Pause'Log'*'</code>
<code> [19]      :Else</code>
<code> [20]          :If AliasChar∊msg</code>
<code> [21]              (alias msg)←{l←⍵⍳AliasChar ⋄ (l↑⍵)(l↓⍵)}msg</code>
<code> [22]              :If 0=flag←~∨/({⍵↑⍨⍵⍳'@'}¨NoPause[;1])≡¨⊂alias</code>
<code> [23]                  'Pause'Log alias</code>
<code> [24]              :EndIf</code>
<code> [25]          :Else</code>
<code> [26]              :If ∨/bool←NoPause[;1]≡¨⊂msg</code>
<code> [27]                  flag←0</code>
<code> [28]                  'Pause'Log msg</code>
<code> [29]              :EndIf</code>
<code> [30]          :EndIf</code>
<code> [31]      :EndIf</code>
<code> [32]  :EndIf</code>
<code> [33]  :If flag</code>
<code> [34]      :If lineFlag</code>
<code> [35]          ⍞←((⎕PW-1)⍴'─'),LF</code>
<code> [36]      :EndIf</code>
<code> [37]      :If AliasChar∊msg</code>
<code class="emphasize">→[38]          ind←msg⍳AliasChar</code>
<code class="emphasize">→[39]      :AndIf ∧/~(ind↑msg)∊' ',LF</code>
<code class="emphasize">→[40]          msg←ind↓msg</code>
<code> [41]      :EndIf</code>
<code> [42]      input←⍞,0/⍞←({0=≢⍵:⍵ ⋄ ⍵,LF}msg),'In order to continue press &lt;enter&gt; '</code>
<code> [43]      :If '∘∘∘'≡¯3↑input</code>
<code> [44]          (1+⊃⎕LC)⎕STOP⊃⎕SI</code>
<code> [45]          ∘∘∘ ⍝ Deliberate stop caused by user input</code>
<code> [46]      :EndIf</code>
<code> [47]  :EndIf</code>
<code> [48] ⍝Done</code>
</div>
<code class="header" id="listing_13">#.CommTools.CommTools.Select &mdash; 95%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>   index←{x}Select choices</code>
<code> [1]   ⍝ Presents `choices` as a numbered list and allows the user to select either exactly one or multiple ones.</code>
<code> [2]   ⍝ Selecting just one is the default.\\</code>
<code> [3]   ⍝ The optional left argument allows you to specify multiple (positional) choices:</code>
<code> [4]   ⍝  * `caption` is shown above the choices; must be a simple character vector</code>
<code> [5]   ⍝  * `manyFlag` defaults to 0 (= just 1 item might be selected) or 1 (allow selecting multiple items)</code>
<code> [6]   ⍝  * `mustFlag` forces the user to select at least one option, disallowing to quit without making a decision\\</code>
<code> [7]   ⍝ Notes:</code>
<code> [8]   ⍝  * `choices` must not have more than 999 items\\</code>
<code> [9]   ⍝  * By entering "`∘∘∘`" the user may interrupt `Select` by running onto a stop vector, overcoming</code>
<code> [10]  ⍝    the Dyalog bug that ⍞ cannot be interrupted</code>
<code> [11]  ⍝  * You can automate `Select`, refer to the documentation with ]ADoc CommTools, catch "Automation"\\</code>
<code> [12]  ⍝  * If the user aborts by entering "q" (for "quit") `⍬` will be returned</code>
<code> [13]   x←{0&lt;⎕NC ⍵:⊆⍎⍵ ⋄ ''}'x'</code>
<code> [14]   (caption manyFlag mustFlag)←x,(⍴,x)↓'' 0 0</code>
<code> [15]   '"caption" must be a simple character vector'Assert 1=≡caption←,caption</code>
<code> [16]   '"caption" must not contain line feeds (⎕UCS 10)'Assert~LF∊caption</code>
<code> [17]   '"caption" must not contain carriage returns (⎕UCS 13)'Assert~(⎕UCS 13)∊caption</code>
<code> [18]   ⎕IO←1 ⋄ ⎕ML←1</code>
<code> [19]   'Invalid right argument; must be a vector of text vectors.'⎕SIGNAL ErrNo/⍨2≠|≡choices</code>
<code> [20]   'Right argument has more than 999 items'⎕SIGNAL ErrNo/⍨999&lt;≢choices</code>
<code> [21]   flag←0</code>
<code> [22]   firstPart←{⍵↑⍨⍵⍳LF}caption</code>
<code> [23]   :If 0&lt;⎕NC'∆Automation'</code>
<code> [24]   :AndIf 0&lt;≢∆Automation</code>
<code> [25]       Select_Choices←(∆Automation[;1]≡¨⊂'Select')⌿∆Automation[;2 3]</code>
<code> [26]   :AndIf 0&lt;≢Select_Choices</code>
<code> [27]       :If AliasChar∊caption</code>
<code> [28]           (alias caption)←{l←⍵⍳AliasChar ⋄ (l↑⍵)(l↓⍵)}caption</code>
<code> [29]           flag←0&lt;+/bool←({⍵↑⍨(,⍵)⍳AliasChar}¨Select_Choices[;1])≡¨⊂alias</code>
<code> [30]       :Else</code>
<code> [31]           bool←caption∘≡¨Select_Choices[;1]</code>
<code> [32]           flag←0&lt;+/bool</code>
<code> [33]       :EndIf</code>
<code> [34]       :If flag</code>
<code> [35]           'Multiple choices qualify?!'Assert 1=+/bool</code>
<code> [36]           index←2⊃Select_Choices[bool⍳1;]</code>
<code> [37]           'Select'Log⊃Select_Choices[bool⍳1;]</code>
<code> [38]           :If (⊂index)∊0 ⍬</code>
<code> [39]               index←⍬</code>
<code> [40]           :ElseIf ' '=1↑0⍴∊index ⍝ Text?!</code>
<code> [41]               :If '*'=¯1↑index</code>
<code> [42]                   index←⍸((¯1+≢index)↑¨{⍵↓⍨+/∧\' '=⍵}¨choices)≡¨⊂¯1↓index</code>
<code> [43]                   index←{1=≢⍵:⊃⍵ ⋄ ⍵}index</code>
<code> [44]                   'Invalid selection'Assert(mustFlag{(0&lt;≢⍵)≠⍺}index)∨∨/index∊⍳≢choices</code>
<code> [45]               :ElseIf '*'=⊃index</code>
<code> [46]                   index←⍸((-¯1+≢index)↑¨{⍵↓⍨-+/∧\' '=⌽⍵}¨choices)≡¨⊂1↓index</code>
<code> [47]                   index←{1=≢⍵:⊃⍵ ⋄ ⍵}index</code>
<code> [48]                   'Invalid selection'Assert(mustFlag{(0&lt;≢⍵)≠⍺}index)∨∨/index∊⍳≢choices</code>
<code> [49]               :ElseIf (,'a')≡,index</code>
<code> [50]                   index←⍳≢choices</code>
<code> [51]               :ElseIf (,'q')≡,index</code>
<code> [52]                   index←⍬</code>
<code> [53]               :ElseIf 0&lt;≢buff←⍸index∘≡¨choices</code>
<code class="emphasize">→[54]                   index←buff</code>
<code class="emphasize">→[55]                   'Invalid selection'Assert index∊⍳≢choices</code>
<code> [56]               :ElseIf 1=≢index←⍸index∘≡¨(≢index)↑¨{⍵↓⍨+/∧\' '=⍵}¨choices</code>
<code class="emphasize">→[57]                   index←⊃index</code>
<code class="emphasize">→[58]                   'Invalid selection'Assert index∊⍳≢choices</code>
<code> [59]               :Else</code>
<code> [60]                   'Invalid selection'Assert 0</code>
<code> [61]               :EndIf</code>
<code> [62]           :Else</code>
<code> [63]               'Invalid selection'Assert∧/index∊⍳≢choices</code>
<code> [64]           :EndIf</code>
<code> [65]       :EndIf</code>
<code> [66]   :EndIf</code>
<code> [67]   :If ~flag</code>
<code> [68]       flag2←0</code>
<code> [69]       :Repeat</code>
<code> [70]           blankFlag←0≠≢caption</code>
<code> [71]           :If AliasChar∊caption</code>
<code> [72]               :If (firstPart⍳' ')&gt;firstPart⍳AliasChar</code>
<code> [73]                   caption←{~AliasChar∊⍵:⍵ ⋄ ⍵↓⍨⍵⍳AliasChar}caption</code>
<code> [74]               :EndIf</code>
<code> [75]           :EndIf</code>
<code> [76]           ⎕←{⍵↑'---',(blankFlag/' '),caption,(blankFlag/' '),⍵⍴'-'}⎕PW-1</code>
<code> [77]           ⎕←⍪{((⊂'. '),¨⍨(⊂3 0)⍕¨⍳≢⍵),¨⍵}choices</code>
<code> [78]           ⎕←''</code>
<code> [79]           question←'Select one ',(manyFlag/'or more '),'item',((manyFlag)/'s'),' '</code>
<code> [80]           question,←((manyFlag∨~mustFlag)/'('),((~mustFlag)/'q=quit'),((manyFlag∧~mustFlag)/', '),(manyFlag/'a=all'),((manyFlag∨~mustFlag)/')'),' :'</code>
<code> [81]           :If 0&lt;≢answer←⍞,0/⍞←question</code>
<code> [82]               ⎕←answer←{⍵↑⍨-¯1+(⌽⍵)⍳':'}answer</code>
<code> [83]               :If '∘∘∘'≡¯3↑answer</code>
<code> [84]                   (1+⊃⎕LC)⎕STOP⊃⎕SI</code>
<code> [85]                   ∘∘∘ ⍝ Deliberate stop caused by user input</code>
<code> [86]               :EndIf</code>
<code> [87]               :If 1=≢answer</code>
<code> [88]               :AndIf answer∊'Qq',manyFlag/'Aa'</code>
<code> [89]                   :If answer∊'Qq'</code>
<code> [90]                       :If 0=mustFlag</code>
<code> [91]                           index←⍬</code>
<code> [92]                           flag2←1</code>
<code> [93]                       :EndIf</code>
<code> [94]                   :Else</code>
<code> [95]                       index←⍳≢choices</code>
<code> [96]                       flag2←1</code>
<code> [97]                   :EndIf</code>
<code> [98]               :Else</code>
<code> [99]                   (bool value)←⎕VFI answer</code>
<code> [100]                  :If ∧/bool</code>
<code> [101]                  :AndIf manyFlag∨1=+/bool</code>
<code> [102]                      value←bool/value</code>
<code> [103]                  :AndIf ∧/value∊⍳⍴choices</code>
<code> [104]                      index←value</code>
<code> [105]                      flag2←0≠≢index</code>
<code> [106]                  :EndIf</code>
<code> [107]              :EndIf</code>
<code> [108]          :EndIf</code>
<code> [109]      :Until flag2</code>
<code> [110]      index←{1&lt;≢⍵:⍵ ⋄ ⊃⍵}⍣(⍬≢index)⊣index</code>
<code> [111]  :EndIf</code>
<code> [112] ⍝Done</code>
</div>
<code class="header" id="listing_14">#.CommTools.CommTools.AskForText &mdash; 96%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  text←{x}(CheckFn AskForText)question</code>
<code> [1]  ⍝ Operator asking a question and allowing the user to enter text.\\</code>
<code> [2]  ⍝ By entering "`∘∘∘`" the user may interrupt `AskForText`: this activates a stop.\\</code>
<code> [3]  ⍝ `CheckFn` is supposed to be a function that gets the input as `⍵` and must return a Boolean</code>
<code> [4]  ⍝ with a 1 indicating that the input is okay and 0 that it is not. If you don't need/want</code>
<code> [5]  ⍝ a check function pass `{1}` as left operand.\\</code>
<code> [6]  ⍝ If the user refuses to enter anything an empty vector is returned.</code>
<code> [7]  ⍝ However, you might prevent this from happening by specifying a 1 as `⍺` (`enforce`), meaning</code>
<code> [8]  ⍝ that the user must enter something in order to continue.</code>
<code> [9]  ⍝ You can also specify a default as `⍺` by passing a character vector instead of a Boolean.</code>
<code> [10] ⍝ In case the user does not enter something that default is returned; that's why the Boolean</code>
<code> [11] ⍝ would not make a difference anyway.\\</code>
<code> [12]  x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'x'</code>
<code> [13]  firstFlag←1</code>
<code> [14]  :If ' '=1↑0⍴x</code>
<code> [15]      default←x</code>
<code> [16]      enforce←0</code>
<code> [17]  :Else</code>
<code> [18]      enforce←x</code>
<code> [19]      default←''</code>
<code> [20]  :EndIf</code>
<code> [21]  text←''</code>
<code> [22]  success←flag←0</code>
<code> [23]  :If ~(≡question)∊0 1</code>
<code> [24]      question←1↓⊃,/LF,¨question</code>
<code> [25]  :EndIf</code>
<code> [26]  question←ReplaceCRbyLF question</code>
<code> [27]  question←{⍵↓⍨+/∧\' '=⍵}question</code>
<code> [28]  :Repeat</code>
<code> [29]      firstPart←{⍵↑⍨¯1+⌊/⍵⍳LF,' '}question</code>
<code> [30]      :If 0&lt;⎕NC'∆Automation'</code>
<code> [31]          AskForText_Answers←(∆Automation[;1]≡¨⊂'AskForText')⌿∆Automation[;2 3]</code>
<code> [32]          AskForText_Answers←(0&lt;≢¨' '~⍨¨AskForText_Answers[;1])⌿AskForText_Answers</code>
<code> [33]          AskForText_Answers[;1]←{⍵↓⍨+/∧\' '=⍵}¨AskForText_Answers[;1]</code>
<code> [34]      :AndIf 0&lt;≢AskForText_Answers</code>
<code> [35]          :If AliasChar∊firstPart</code>
<code> [36]              (alias question)←{l←⍵⍳AliasChar ⋄ (l↑⍵)(l↓⍵)}question</code>
<code> [37]              :If flag←0&lt;+/bool←({⍵↑⍨⍵⍳AliasChar}¨AskForText_Answers[;1])≡¨⊂alias</code>
<code> [38]                  'AskForText'Log alias</code>
<code> [39]              :EndIf</code>
<code> [40]          :Else</code>
<code> [41]              :If flag←0&lt;+/bool←({⍵,(':'≠¯1↑⍵)/':'}¨AskForText_Answers[;1])≡¨⊂question,(':'≠¯1↑question)/':'</code>
<code> [42]                  'AskForText'Log question,(':'≠¯1↑question)/':'</code>
<code> [43]              :EndIf</code>
<code> [44]          :EndIf</code>
<code> [45]          :If flag</code>
<code> [46]              'Multiple pre-prepared answers qualify?!'Assert 1=+/bool</code>
<code> [47]              text←2⊃AskForText_Answers[bool⍳1;]</code>
<code> [48]          :EndIf</code>
<code> [49]      :Else</code>
<code> [50]          :If (⌊/firstPart⍳' ',LF)&gt;firstPart⍳AliasChar</code>
<code class="emphasize">→[51]              question←{~AliasChar∊⍵:⍵ ⋄ ⍵↓⍨⍵⍳AliasChar}question</code>
<code> [52]          :EndIf</code>
<code> [53]      :EndIf</code>
<code> [54]      :If 0&lt;≢default</code>
<code> [55]      :AndIf firstFlag</code>
<code> [56]          question,←' [',default,']'</code>
<code> [57]          firstFlag←0</code>
<code> [58]      :EndIf</code>
<code> [59]      :If ~flag</code>
<code> [60]          text←⍞,0/⍞←question,((':'≠¯1↑question)/':'),' '</code>
<code> [61]          text←{⍵↑⍨2+-(⌽⍵)⍳':'}text</code>
<code> [62]          :If '∘∘∘'≡¯3↑text</code>
<code> [63]              (1+⊃⎕LC)⎕STOP⊃⎕SI</code>
<code> [64]              ∘∘∘ ⍝ Deliberate stop caused by user input</code>
<code> [65]          :EndIf</code>
<code> [66]          :If 0=≢text</code>
<code> [67]          :AndIf 0&lt;≢default</code>
<code> [68]              text←default</code>
<code> [69]          :EndIf</code>
<code> [70]      :EndIf</code>
<code> [71]      :If 0=≢text</code>
<code> [72]          :If enforce</code>
<code class="emphasize">→[73]              ⎕←'You must enter something!'</code>
<code> [74]          :Else</code>
<code> [75]              :Return</code>
<code> [76]          :EndIf</code>
<code> [77]      :Else</code>
<code> [78]          success←CheckFn text</code>
<code> [79]      :EndIf</code>
<code> [80]  :Until success</code>
<code> [81] ⍝Done</code>
</div>
<code class="header" id="listing_15">#.CommTools.CommTools.YesOrNo &mdash; 96%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>   yesOrNo←{default}YesOrNo question</code>
<code> [1]   ⍝ Asks a simple question and allows just "Y" (or "y") or "N" (or "n") as answers.\\</code>
<code> [2]   ⍝ The question may be a simple character vector, possibly with `⎕UCS 10` in between,</code>
<code> [3]   ⍝ or a vector of simple character vectors.\\</code>
<code> [4]   ⍝ You may specify a default via the optional left argument which, when specified,</code>
<code> [5]   ⍝ rules what happens when the user just presses &lt;enter&gt; without entering anything.</code>
<code> [6]   ⍝ `default` must be either 1 (yes) or 0 (no).\\</code>
<code> [7]   ⍝ By entering "`∘∘∘`" the user may interrupt `YesOrNo`: this activates a stop.\\</code>
<code> [8]   ⍝ You can make `YesOrNo` answer the question automatically, refer to the documentation</code>
<code> [9]   ⍝ with ]ADoc CommTools, catch "Automation"\\</code>
<code> [10]  ⍝ Note that this function does **not** work as intended when traced!</code>
<code> [11]   isOkay←0</code>
<code> [12]   default←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'default'</code>
<code> [13]   isOkay←0</code>
<code> [14]   :If ~(≡question)∊0 1</code>
<code> [15]       question←1↓⊃,/LF,¨question</code>
<code> [16]   :EndIf</code>
<code> [17]   question←ReplaceCRbyLF question</code>
<code> [18]   question←{⍵↓⍨+/∧\' '=⍵}question</code>
<code> [19]   question,←(~'?'∊question)/'?'</code>
<code> [20]   :If 0≠≢default</code>
<code> [21]       'Left argument must be a scalar'⎕SIGNAL 11/⍨1≠≢default</code>
<code> [22]   :AndIf ~default∊0 1</code>
<code class="emphasize">→[23]       'The left argument. if specified, must be a Boolean or empty'⎕SIGNAL 11</code>
<code> [24]   :EndIf</code>
<code> [25]   flag←1</code>
<code> [26]   firstPart←{⍵↑⍨⍵⍳LF}question</code>
<code> [27]   :If 0&lt;⎕NC'∆Automation'</code>
<code> [28]   :AndIf 0&lt;≢Answers←(∆Automation[;1]≡¨⊂'YesOrNo')⌿∆Automation[;2 3]</code>
<code> [29]       :If AliasChar∊firstPart</code>
<code> [30]           ind←firstPart⍳AliasChar</code>
<code> [31]           (alias question)←ind{(⍺↑⍵)(⍺↓⍵)}firstPart</code>
<code> [32]           flag←0&lt;+/bool←({⍵↑⍨⍵⍳AliasChar}¨Answers[;1])≡¨⊂alias</code>
<code> [33]       :ElseIf ~flag←0&lt;+/bool←({⍵,(~'?'∊⍵)/'?'}¨Answers[;1])≡¨⊂question</code>
<code> [34]       :AndIf LF∊question</code>
<code> [35]           buff←{⍵↓⍨+/∧\' '=⍵}⊃¯1↑LF(≠⊆⊢)question</code>
<code> [36]           flag←0&lt;+/bool←Answers[;1]≡¨⊂buff</code>
<code> [37]       :EndIf</code>
<code> [38]       :If flag</code>
<code> [39]           'Multiple pre-prepared answers qualify?!'Assert 1=+/bool</code>
<code> [40]           answer←2⊃Answers[bool⍳1;]</code>
<code> [41]           'YesOrNo'Log⊃Answers[bool⍳1;1]</code>
<code> [42]           :If 0=≢answer</code>
<code> [43]               yesOrNo←default</code>
<code> [44]           :Else</code>
<code> [45]               ('Invalid answer: ',answer)Assert answer∊'YyNn'</code>
<code> [46]               yesOrNo←answer∊'Yy'</code>
<code> [47]           :EndIf</code>
<code> [48]       :EndIf</code>
<code> [49]   :Else</code>
<code> [50]       flag←0</code>
<code> [51]   :EndIf</code>
<code> [52]   :If ~flag</code>
<code> [53]       :If 0=≢default</code>
<code> [54]           add←' (y/n) '</code>
<code> [55]       :Else</code>
<code> [56]           :If default</code>
<code> [57]               add←' (Y/n) '</code>
<code> [58]           :Else</code>
<code> [59]               add←' (y/N) '</code>
<code> [60]           :EndIf</code>
<code> [61]       :EndIf</code>
<code> [62]       :If 1&lt;≡question</code>
<code class="emphasize">→[63]           question←1↓⊃,/LF,¨question</code>
<code> [64]       :EndIf</code>
<code> [65]       :If (⌊/firstPart⍳' ',LF)&gt;firstPart⍳AliasChar</code>
<code class="emphasize">→[66]           question←{~AliasChar∊⍵:⍵ ⋄ ⍵↓⍨⍵⍳AliasChar}question,add</code>
<code> [67]       :Else</code>
<code> [68]           question,←add</code>
<code> [69]       :EndIf</code>
<code> [70]       :Repeat</code>
<code> [71]           ⎕←''</code>
<code> [72]           ⍞←question</code>
<code> [73]           answer←⍞</code>
<code> [74]           :If answer≡question ⍝ Did ...  (since version 18.0 trailing blanks are not removed anymore)</code>
<code> [75]           :OrIf (≢answer)=¯1+≢question ⍝ ... the ...</code>
<code> [76]           :OrIf 0=≢answer                                                          ⍝ ... user ...</code>
<code> [77]           :OrIf question≡(-≢question)↑answer                                       ⍝ ... just ...</code>
<code> [78]               dtb←{⍵↓⍨-+/∧\' '=⌽⍵}</code>
<code> [79]               answer2←dtb answer</code>
<code> [80]           :OrIf answer2≡((-≢answer2)↑LF{~⍺∊⍵:⍵ ⋄ ' ',dtb ⍺{⌽⍵↑⍨1+⍵⍳⍺}⌽⍵}question)  ⍝ ... press ...</code>
<code> [81]           :OrIf answer≡{1↓⊃¯1↑(⍵=LF)⊂⍵}LF,question                                 ⍝ ... &lt;enter&gt;?</code>
<code> [82]           :OrIf answer≡⎕PW↓question</code>
<code> [83]               :If 0≠≢default</code>
<code> [84]                   yesOrNo←default</code>
<code> [85]                   isOkay←1</code>
<code> [86]               :EndIf</code>
<code> [87]           :Else</code>
<code> [88]               :If '∘∘∘'≡¯3↑answer</code>
<code> [89]                   (1+⊃⎕LC)⎕STOP⊃⎕SI</code>
<code> [90]                   ∘∘∘ ⍝ Deliberate stop caused by user input</code>
<code> [91]               :EndIf</code>
<code> [92]               answer←¯1↑{⍵↓⍨-+/∧\' '=⌽⍵}answer</code>
<code> [93]               :If answer∊'YyNn'</code>
<code> [94]                   isOkay←1</code>
<code> [95]                   yesOrNo←answer∊'Yy'</code>
<code> [96]               :EndIf</code>
<code> [97]           :EndIf</code>
<code> [98]       :Until isOkay</code>
<code> [99]   :EndIf</code>
<code> [100] ⍝Done</code>
</div>
<code class="header" id="listing_16">#.CommTools.CommTools.Assert &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Assert←{⍺←'' ⋄ (,1)≡,⍵:r←1 ⋄ ⎕ML←1 ⋄ ⍺ ⎕SIGNAL 1↓(⊃∊⍵),11}</code>
</div>
<code class="header" id="listing_17">#.CommTools.CommTools.Cleanup &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Cleanup</code>
<code> [1]  ⎕EX¨'Select_Choices' 'YesOrNo_Answers' 'NoPause' 'AskForNumber_Answers' 'AskForText_Answers' '∆LogAutoResponses' ⍝ Old stuff</code>
<code> [2]  ⎕EX'∆Automation'</code>
</div>
<code class="header" id="listing_18">#.CommTools.CommTools.ErrNo &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ErrNo</code>
<code> [1]  r←811</code>
</div>
<code class="header" id="listing_19">#.CommTools.CommTools.FindAutomationIndex &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ind←FindAutomationIndex(type id)</code>
<code> [1]  ⍝ Returns the line in ∆Automation (if that exists) when type and id match ∆Automation[;1 2]</code>
<code> [2]  ⍝ In case ∆Automation does not exist or no line fits `⍬` is returned.</code>
<code> [3]   ind←⍬</code>
<code> [4]   'Invalid type'Assert(⊂type)∊'YesOrNo' 'AskForNumber' 'AskForText' 'Pause' 'Select'</code>
<code> [5]   :If 0&lt;⎕NC'∆Automation'</code>
<code> [6]   :AndIf 0&lt;≢∆Automation</code>
<code> [7]       :If '@'∊id</code>
<code> [8]           bool←(∆Automation[;1]≡¨⊂type)∧(({⍵↑⍨⍵⍳'@'}¨∆Automation[;2])≡¨⊂{⍵↑⍨⍵⍳'@'}id)</code>
<code> [9]       :Else</code>
<code> [10]          bool←(∆Automation[;1]≡¨⊂type)∧(∆Automation[;2]≡¨⊂id)</code>
<code> [11]      :EndIf</code>
<code> [12]      :If ⍬≢ind←⍸,bool</code>
<code> [13]          ind←⊃ind</code>
<code> [14]      :EndIf</code>
<code> [15]  :EndIf</code>
</div>
<code class="header" id="listing_20">#.CommTools.CommTools.Help &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Help</code>
<code> [1]  ⎕SE.UCMD'ADOC ',⍕⎕THIS</code>
</div>
<code class="header" id="listing_21">#.CommTools.CommTools.LF &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←LF</code>
<code> [1]  r←⎕UCS 10</code>
</div>
<code class="header" id="listing_22">#.CommTools.CommTools.ListAutomation &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{rawFlag}ListAutomation type</code>
<code> [1]  ⍝ Returns the contents of ∆Automation with column titles by default but check `rawFlag`.</code>
<code> [2]  ⍝ If `type` is not empty it is interpreted as a list of types.</code>
<code> [3]  ⍝ Only data of the given types is then returned.\\</code>
<code> [4]  ⍝ If `∆Automation` does not exist or is empty or does not have data for the requested types,</code>
<code> [5]  ⍝ a message is returned.\\</code>
<code> [6]  ⍝ If the optional left argument is specified and is 1, a matrix with pure data (no column titles)</code>
<code> [7]  ⍝ is returned, possibly empty.</code>
<code> [8]   rawFlag←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'rawFlag'</code>
<code> [9]   'Optional left argument must be a Boolean'Assert(⊂rawFlag)∊0 1</code>
<code> [10]  type←{0=≢⍵:⍵ ⋄ ,⊆⍵}type</code>
<code> [11]  'Invalid type'Assert∧/type∊'YesOrNo' 'Select' 'Pause' 'AskForText' 'AskForNumber' ''</code>
<code> [12]  :If 0=⎕NC'∆Automation'</code>
<code> [13]      :If rawFlag</code>
<code> [14]          r←0 4⍴⊂''</code>
<code> [15]      :Else</code>
<code> [16]          r←'∆Automation does not exist'</code>
<code> [17]      :EndIf</code>
<code> [18]  :Else</code>
<code> [19]      r←∆Automation</code>
<code> [20]      :If 0&lt;≢type</code>
<code> [21]          r←(∆Automation[;1]∊type)⌿∆Automation</code>
<code> [22]      :EndIf</code>
<code> [23]      :If ~rawFlag</code>
<code> [24]          :If 0=≢r</code>
<code> [25]              r←'No data ',(1+0&lt;≢type)⊃'available'('found for ',⊃{⍺,', ',⍵}/type)</code>
<code> [26]          :Else</code>
<code> [27]              r←({(⍉⍪⍵)⍪((≢¨⍵)⍴¨'-')}'Type' 'ID' 'Returns' 'Counter')⍪r</code>
<code> [28]          :EndIf</code>
<code> [29]      :EndIf</code>
<code> [30]  :EndIf</code>
</div>
<code class="header" id="listing_23">#.CommTools.CommTools.Log &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {ind}←type Log id</code>
<code> [1]  ind←⍬</code>
<code> [2]  'Invalid type'Assert(⊂type)∊'AskForNumber' 'AskForText' 'Select' 'YesOrNo' 'Pause'</code>
<code> [3]  :If 0&lt;⎕NC'∆Automation'</code>
<code> [4]  :AndIf ⍬≢ind←FindAutomationIndex type id</code>
<code> [5]      ∆Automation[ind;4]+←1</code>
<code> [6]  :EndIf</code>
</div>
<code class="header" id="listing_24">#.CommTools.CommTools.Public &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←Public</code>
<code> [1]   r←''</code>
<code> [2]   r,←⊂'AskForText'</code>
<code> [3]   r,←⊂'AskForNumber'</code>
<code> [4]   r,←⊂'Select'</code>
<code> [5]   r,←⊂'YesOrNo'</code>
<code> [6]   r,←⊂'Pause'</code>
<code> [7]   r,←⊂'Cleanup'</code>
<code> [8]   r,←⊂'AddAutomation'</code>
<code> [9]   r,←⊂'FindAutomationIndex'</code>
<code> [10]  r,←⊂'ListAutomation'</code>
<code> [11]  r,←⊂'Help'</code>
</div>
<code class="header" id="listing_25">#.CommTools.CommTools.ReplaceCRbyLF &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ReplaceCRbyLF←{LF@(⍸⍵=⎕UCS 13)⊣⍵}</code>
</div>
<div id="footer">
<hr>
<p>Created by "CodeCoverage" version 0.10.7+52 from 2024-06-05</p>
</div>

</body>
</html>
